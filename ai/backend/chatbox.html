<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>VR Anatomy Assistant</title>
  <link rel="stylesheet" href="chatbox.css" />
</head>
<body>
  <div class="scene">
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="grid"></div>
  </div>

  <div class="chat-shell">
   

    <div class="chat-container">
      <header class="chat-header">
        <div class="avatar">ğŸ§ </div>
        <div class="titles">
          <div class="title">VR Anatomy AsistanÄ±</div>
          <div class="subtitle">Ders kitabÄ± tabanlÄ± yardÄ±mcÄ±</div>
        </div>
        <div class="status">
          <span class="dot"></span>
          Aktif
        </div>
      </header>

      <div class="chat-messages" id="messages">
        <div class="message bot">
          Merhaba ğŸ‘‹  
          Ben <b>VR Anatomy AsistanÄ±</b>.  
          Anatomi ile ilgili sorularÄ±nÄ± ders kitabÄ±na dayalÄ± olarak cevaplarÄ±m.
        </div>
      </div>

      <div class="chat-input">
        <div class="input-pill">
          <button id="micBtn"
                  class="icon-button"
                  onclick="startListening(document.getElementById('questionInput'))">
            ğŸ¤
          </button>

          <input id="questionInput"
                 placeholder="Anatomi ile ilgili bir soru sor..."
                 onkeydown="if(event.key==='Enter') sendMessage()" />

          <button class="send-btn" onclick="sendMessage()">
            GÃ¶nder
            <span class="pulse"></span>
          </button>
        </div>
        <div class="input-hint">Enter ile gÃ¶nder â€¢ ğŸ¤ ile konuÅŸ</div>
      </div>
    </div>
  </div>

  <script>
const messagesDiv = document.getElementById("messages");
const input = document.getElementById("questionInput");

function addMessage(text, sender) {
  const div = document.createElement("div");
  div.className = "message " + sender;

  if (sender === "bot") {
    div.innerHTML = `
      <div class="bot-text">${text}</div>
      <button class="tts-btn">ğŸ”Š Dinle</button>
    `;

    const btn = div.querySelector(".tts-btn");

    btn.onclick = () => {
      if (!isSpeaking) {
        speakText(text);
        btn.textContent = "â¹ï¸ Durdur";
      } else {
        stopSpeaking();
        btn.textContent = "ğŸ”Š Dinle";
      }
    };

  } else {
    div.textContent = text;
  }

  messagesDiv.appendChild(div);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

function fillPrompt(text) {
  input.value = text;
  input.focus();
}

async function sendMessage() {
  const question = input.value.trim();
  if (!question) return;

  addMessage(question, "user");
  input.value = "";

  addMessage("YanÄ±t hazÄ±rlanÄ±yor...", "bot");

  try {
    const res = await fetch("http://127.0.0.1:8000/ask", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ question })
    });

    const data = await res.json();
    messagesDiv.lastChild.remove();
    addMessage(data.answer, "bot");
  

  } catch {
    messagesDiv.lastChild.remove();
    addMessage("Sunucuya baÄŸlanÄ±lamadÄ±.", "bot");
  }
}
  </script>

  <script src="tts.js"></script>
  <script src="stt.js"></script>
</body>
</html>
